---
date: '2016-12-10 22:57 +0800'
published: true
title: Android多线程
category:
  - Android
tags:
  - Android
  - 多线程
---
## 线程是什么？

线程是进程内一个相对独立、可调度的执行单元，是系统调度和分配CPU的基本单位。一个线程包含四项：线程ID、当前指令指针、寄存器、堆栈。线程共享其所在进程的系统资源。线程有如下几种状态。

{% fi http://afirsraftgarrier.qiniudn.com/thread-status.png %}

## 多线程是什么？

多线程顾名思义是多个线程。为什么要有多线程？简单讲就是单线程只能做一件事，而多线程能同时做很多事。多个线程并发执行，可充分利用系统处理器资源，提升程序整体处理性能。比如在Android里面，我们有个耗时的下载任务，这件事不能放在主线程（UI线程）里面执行呢？答案显然不能，我们知道Android的UI线程是一个特殊的线程，不能在里面执行耗时的操作比如网络请求、I/O等，不然会出现比如[`ANR`](/2016/12/12/2016-12-12-andriod-anr)等错误，另外当UI线程在收到刷新界面信号的时候，如果之中执行了某个耗时操作，导致无法完成这次刷新操作，就会出现`掉帧`现象，也就是我们常说的卡顿（一般降到20fps的时候用户就明显感觉到），这样对于用户体验是非常不好的。于是想到要将耗时操作放到其他线程里面执行，而UI线程则可专注于UI的绘制。

## 有哪些方式实现Android多线程？

## 工作线程与UI线程如何通信？

## Android多线程要注意什么问题？

* 在工作线程里面不能更新UI。Android里面通过[`ViewRootImpl.checkThread`](http://androidxref.com/7.0.0_r1/xref/frameworks/base/core/java/android/view/ViewRootImpl.java#checkThread)来确保这点。下面为为什么不能这么做的一些原因。
	* 程序领域的解耦。
   * 线程同步开销。
   * 容易出现死锁。
* 注意降低设置工作线程的优先级，这样减少影响UI线程。
* 注意线程安全问题，保证数据一致性。
* 注意使用`synchronized`的方式，能少就少，因为同步会影响性能。
* 注意避免死锁问题。
